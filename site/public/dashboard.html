<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Tracking Vision</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/style-dashboard.css">
    <link rel="icon" href="../assets/imgs/Logo T-Vision.png">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="../js/funcoes.js"></script>
</head>

<body onload="createMaquina()">
    <header>
        <hr class="barra_header">
        <div class="container_header">
            <div class="box_header">
                <a href="#home">
                    <img class="logo_header" src="./assets/imgs/Logo T-Vision.png" alt="Logo">
                </a>
                <div id="menu" class="container_nav_menu">
                    <nav id="menuClose" class="boxClose">
                        <div class="box_nav">
                            <a href="cadastroFuncionario.html" id="cadastroFunc">Cadastro funcionário</a>
                            <a href="bloqueio.html" id="cadastroMaq">Cadastro janela</a>
                            <a onclick="limparSessao()">Sair</a>
                            <div id="containerClose" class="container_imgClose">
                                <div id="imgClose" class="box_imgClose" onclick="MenuHidden()">
                                    <img src="./assets/imgs/close.png" alt="img_close">
                                </div>
                            </div>
                        </div>
                    </nav>
                    <div id="menuOpen" class="boxOpen" onclick="MenuShow()">
                        <div class="box_imgMenu">
                            <img src="./assets/imgs/menu.png" alt="img_hamburger">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <section>
        <div class="container_grafico">
            <div class="box_grafico">
                <div class="box_tituloAlert">
                    <span>Nome Gráfico</span>
                    <div class="box_alert" id="box_alert_grafico1"></div>
                </div>
                <div class="chart">
                    <canvas id="myChart"></canvas>
                </div>
                <div class="container_alert_kpi" onclick="abrirGrafico(0)">
                    <div class="box_titulo_metrica">
                        <span>Métrica</span>
                    </div>
                    <div class="box_kpi">
                        <div class="box_kpi_icon_percent">
                            <img src="./assets/imgs/correto.png" alt="Correto">
                            <span id="okGraph1">0%</span>
                        </div>
                        <div class="box_kpi_icon_percent">
                            <img src="./assets/imgs/aviso.png" alt="Aviso">
                            <span id="avisoGraph1">0%</span>
                        </div>
                        <div class="box_kpi_icon_percent">
                            <img src="./assets/imgs/perigo.png" alt="Perigo">
                            <span id="perigoGraph1">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="box_grafico">
                <div class="box_tituloAlert">
                    <span>Nome Gráfico</span>
                    <div class="box_alert" id="box_alert_grafico2"></div>
                </div>
                <div class="chart2">
                    <canvas id="myChart2"></canvas>
                </div>
                <div class="container_alert_kpi" onclick="abrirGrafico(1)">
                    <div class="box_titulo_metrica">
                        <span>Métrica</span>
                    </div>
                    <div class="box_kpi">
                        <div class="box_kpi_icon_percent">
                            <img src="./assets/imgs/correto.png" alt="Correto">
                            <span id="okGraph2">0%</span>
                        </div>
                        <div class="box_kpi_icon_percent">
                            <img src="./assets/imgs/aviso.png" alt="Aviso">
                            <span id="avisoGraph2">0%</span>
                        </div>
                        <div class="box_kpi_icon_percent">
                            <img src="./assets/imgs/perigo.png" alt="Perigo">
                            <span id="perigoGraph2">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="box_grafico">
                <div class="box_tituloAlert">
                    <span>Nome Gráfico</span>
                    <div class="box_alert" id="box_alert_grafico3"></div>
                </div>
                <div class="chart3">
                    <canvas id="myChart3"></canvas>
                </div>
                <div class="container_alert_kpi" onclick="abrirGrafico(2)">
                    <div class="box_titulo_metrica">
                        <span>Métrica</span>
                    </div>
                    <div class="box_kpi">
                        <div class="box_kpi_icon_percent">
                            <img src="./assets/imgs/correto.png" alt="Correto">
                            <span id="okGraph3">0%</span>
                        </div>
                        <div class="box_kpi_icon_percent">
                            <img src="./assets/imgs/aviso.png" alt="Aviso">
                            <span id="avisoGraph3">0%</span>
                        </div>
                        <div class="box_kpi_icon_percent">
                            <img src="./assets/imgs/perigo.png" alt="Perigo">
                            <span id="perigoGraph3">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section>
        <div class="container_maquina">
            <div class="container_card_all_maquina">
                <div class="container_card_maquina">
                    <div class="containerBox_maquina" id="maquinas_box"></div>
                </div>
            </div>
            <div class="container_tools">
                <div id="box_tool_edit" class="box_edit">
                    <img draggable="false" src="../assets/imgs/edit.png" alt="Icon editar">
                </div>
                <div id="box_tool_remove" class="box_remove">
                    <img draggable="false" src="../assets/imgs/excluir.png" alt="Icon excluir">
                </div>
            </div>
        </div>
    </section>

    <div class="areaGrafico">
        <div class="container_area">
            <ul class="circles">
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
                <li></li>
            </ul>
        </div>
    </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/pt-br.min.js"
    integrity="sha512-1IpxmBdyZx3okPiZ14mzw6+pOGa690uDmcdjqvT310Kwv3NRcjvL/aOtoSprEyvkDdAb7ZtM2um6KrLqLOY97w=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>


<script>
    var menu = document.getElementById("menu");
    var menuOpen = document.getElementById("menuOpen");
    var menuClose = document.getElementById("menuClose");
    var imgClose = document.getElementById("imgClose");
    var containerClose = document.getElementById("containerClose");
    const containerMaquina = document.getElementById("maquinas_box");
    var qtdMaquina;

    function verifyQtd() {
        if (qtdMaquina == 0) {
            containerMaquina.innerHTML = `<div class="box_imgEmpty"><img class="imgEmpty" src="../assets/imgs/empty.png"><span>Vazio</span></div>`;
        }
    }

    var elementOk1 = document.getElementById("okGraph1");
    var elementOk2 = document.getElementById("okGraph2");
    var elementOk3 = document.getElementById("okGraph3");

    var elementAviso1 = document.getElementById("avisoGraph1");
    var elementAviso2 = document.getElementById("avisoGraph2");
    var elementAviso3 = document.getElementById("avisoGraph3");

    var elementPerigo1 = document.getElementById("perigoGraph1");
    var elementPerigo2 = document.getElementById("perigoGraph2");
    var elementPerigo3 = document.getElementById("perigoGraph3");

    var valueOk1;
    var valueOk2;
    var valueOk3;

    var valueAviso1;
    var valueAviso2;
    var valueAviso3;

    var valuePerigo1;
    var valuePerigo2;
    var valuePerigo3;

    function carregarLimites() {
        var idEmpresa = sessionStorage.getItem("ID_USUARIO");
        fetch(`/limites/listarGrafico/${idEmpresa}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {
            if (resposta.ok) {
                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    elementOk1.innerHTML = `${json[0].ok}%`;
                    valueOk1 = json[0].ok;

                    elementOk2.innerHTML = `${json[1].ok}%`;
                    valueOk2 = json[1].ok;

                    elementOk3.innerHTML = `${json[2].ok}%`;
                    valueOk3 = json[2].ok;

                    elementAviso1.innerHTML = `${json[0].aviso}%`;
                    valueAviso1 = json[0].aviso;

                    elementAviso2.innerHTML = `${json[1].aviso}%`;
                    valueAviso2 = json[1].aviso;

                    elementAviso3.innerHTML = `${json[2].aviso}%`;
                    valueAviso3 = json[2].aviso;

                    elementPerigo1.innerHTML = `${json[0].perigo}%`;
                    valuePerigo1 = json[0].perigo;

                    elementPerigo2.innerHTML = `${json[1].perigo}%`;
                    valuePerigo2 = json[1].perigo;

                    elementPerigo3.innerHTML = `${json[2].perigo}%`;
                    valuePerigo3 = json[2].perigo;
                })
            }
        })
    }

    carregarLimites();

    function abrirMaquina(id) {
        Swal.fire({
            customClass: {
                confirmButton: 'btn_maquina',
            },
            // buttonsStyling: false,
            width: 1300,
            confirmButtonText: 'Sair',
            html:
                '<div class="box_titulo_maquina">' +
                '<span>Máquina</span>' +
                '</div>' +
                '<div class="all_maquina_modal">' +
                '<div class="box_maquina_modal">' +
                '<div class="box_dado_maquina">' +
                '<span id="idMaquina">ID máquina: </span>' +
                '</div>' +
                '<div class="box_dado_maquina">' +
                '<span id="modeloCpu">Modelo CPU: </span>' +
                '</div>' +
                '<div class="box_dado_maquina">' +
                '<span id="maxRam">Máx RAM: </span>' +
                '</div>' +
                '<div class="box_dado_maquina">' +
                '<span id="totalDisco">Total disco: </span>' +
                '</div>' +
                '<div class="box_dado_maquina">' +
                '<span id="nomeRede">Nome rede: </span>' +
                '</div>' +
                '</div>' +
                '<div class="box_maquina_modal">' +
                '<div class="box_dado_maquina">' +
                '<span id="mac">Mac: </span>' +
                '</div>' +
                '<div class="box_dado_maquina">' +
                '<span id="clockCPU">Clock CPU: </span>' +
                '</div>' +
                '<div class="box_logo_modal">' +
                '<img src="./assets/imgs/Logo T-Vision.png">' +
                '</div>' +
                '<div class="box_dado_maquina">' +
                '<span id="leituraDisco">Leitura disco: </span>' +
                '</div>' +
                '<div class="box_dado_maquina">' +
                '<span id="nomeHost">Nome exibição: </span>' +
                '</div>' +
                '</div>' +
                '<div class="box_maquina_modal">' +
                '<div class="box_dado_maquina">' +
                '<span id="status">Status: </span>' +
                '</div>' +
                '<div class="box_dado_maquina">' +
                '<span id="modeloRAM">Modelo RAM: </span>' +
                '</div>' +
                '<div class="box_dado_maquina">' +
                '<span id="modeloDisco">Modelo disco: </span>' +
                '</div>' +
                '<div class="box_dado_maquina">' +
                '<span id="escritaDisco">Escrita disco: </span>' +
                '</div>' +
                '<div class="box_dado_maquina">' +
                '<span id="ipv4">IPV4: </span>' +
                '</div>' +
                '</div>' +
                '<div class="container_kpi_modal">' +
                '<div class="model_kpi box_kpi_maquina_modal_ok">' +
                '<div class="box_value_icon_maquina">' +
                '<img class="img_kpi_icon" src="./assets/imgs/okKPI.png">' +
                `<span id="kpiOk">0%</span>` +
                '</div>' +
                '<div class="box_descricaoKpi">' +
                `<span>Sucesso</span>` +
                `<span>Está tudo certo</span>` +
                '</div>' +
                '</div>' +
                '<div class="model_kpi box_kpi_maquina_modal_aviso">' +
                '<div class="box_value_icon_maquina">' +
                '<img class="img_kpi_icon" src="./assets/imgs/avisoKPI.png">' +
                `<span id="kpiAviso">0%</span>` +
                '</div>' +
                '<div class="box_descricaoKpi">' +
                `<span>Aviso</span>` +
                `<span>Tenha cuidado</span>` +
                '</div>' +
                '</div>' +
                '<div class="model_kpi box_kpi_maquina_modal_perigo">' +
                '<div class="box_value_icon_maquina">' +
                '<img class="img_kpi_icon" src="./assets/imgs/perigoKPI.png">' +
                `<span id="kpiPerigo">0%</span>` +
                '</div>' +
                '<div class="box_descricaoKpi">' +
                `<span>Perigo</span>` +
                `<span>É preciso de ajuste</span>` +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>',
        })

        fetch(`/maquina/listarPorId/${id}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    var ok = document.getElementById("kpiOk");
                    var aviso = document.getElementById("kpiAviso");
                    var perigo = document.getElementById("kpiPerigo");
                    var maqId = document.getElementById("idMaquina");
                    var maqModelCPU = document.getElementById("modeloCpu");
                    var maqMaxRam = document.getElementById("maxRam");
                    var maqTotalDisco = document.getElementById("totalDisco");
                    var maqNomeRede = document.getElementById("nomeRede");
                    var maqMac = document.getElementById("mac");
                    var maqClockCPU = document.getElementById("clockCPU");
                    var maqLeiDisco = document.getElementById("leituraDisco");
                    var maqNomeHost = document.getElementById("nomeHost");
                    var maqStatus = document.getElementById("status");
                    var maqModelRAM = document.getElementById("modeloRAM");
                    var maqModelDisco = document.getElementById("modeloDisco");
                    var maqEscritaDisco = document.getElementById("escritaDisco");
                    var maqIpv4 = document.getElementById("ipv4");

                    alert(JSON.stringify(json));

                    if (JSON.stringify(json[0].idMaquina).length > 13) {
                        maqId.innerHTML += `<marquee scrolldelay="125">${json[0].idMaquina}</marquee>`;
                    } else {
                        maqId.innerHTML += `${json[0].idMaquina}`;
                    }

                    if (JSON.stringify(json[0].nomeModeloCpu).length > 13) {
                        maqModelCPU.innerHTML += `<marquee scrolldelay="125">${json[0].nomeModeloCpu}</marquee>`;
                    } else {
                        maqModelCPU.innerHTML += `${json[0].nomeModeloCpu}`;
                    }

                    if (JSON.stringify(json[0].capacidadeTotalRam).length > 13) {
                        maqMaxRam.innerHTML += `<marquee scrolldelay="125">${json[0].capacidadeTotalRam}</marquee>`;
                    } else {
                        maqMaxRam.innerHTML += `${json[0].capacidadeTotalRam}`;
                    }

                    if (JSON.stringify(json[0].capacidadeTotalDisco).length > 13) {
                        maqTotalDisco.innerHTML += `<marquee scrolldelay="125">${json[0].capacidadeTotalDisco}</marquee>`;
                    } else {
                        maqTotalDisco.innerHTML += `${json[0].capacidadeTotalDisco}`;
                    }

                    if (JSON.stringify(json[0].nomeRede).length > 13) {
                        maqNomeRede.innerHTML += `<marquee scrolldelay="125">${json[0].nomeRede}</marquee>`;
                    } else {
                        maqNomeRede.innerHTML += `${json[0].nomeRede}`;
                    }

                    if (JSON.stringify(json[0].mac).length > 13) {
                        maqMac.innerHTML += `<marquee scrolldelay="125">${json[0].mac}</marquee>`;
                    } else {
                        maqMac.innerHTML += `${json[0].mac}`;
                    }

                    if (JSON.stringify(json[0].clockCpu).length > 13) {
                        maqClockCPU.innerHTML += `<marquee scrolldelay="125">${json[0].clockCpu}</marquee>`;
                    } else {
                        maqClockCPU.innerHTML += `${json[0].clockCpu}`;
                    }

                    if (JSON.stringify(json[0].leituraDisco).length > 13) {
                        maqLeiDisco.innerHTML += `<marquee scrolldelay="125">${json[0].leituraDisco}</marquee>`;
                    } else {
                        maqLeiDisco.innerHTML += `${json[0].leituraDisco}`;
                    }

                    if (JSON.stringify(json[0].hostnameMaquina).length > 13) {
                        maqNomeHost.innerHTML += `<marquee scrolldelay="125">${json[0].hostnameMaquina}</marquee>`;
                    } else {
                        maqNomeHost.innerHTML += `${json[0].hostnameMaquina}`;
                    }

                    maqStatus.innerHTML += `${json[0].statusMaquina.data[0] == 1 ? "Ativo" : "Inativo"}`;

                    if (JSON.stringify(json[0].nomeModeloRam).length > 13) {
                        maqModelRAM.innerHTML += `<marquee scrolldelay="125">${json[0].nomeModeloRam}</marquee>`;
                    } else {
                        maqModelRAM.innerHTML += `${json[0].nomeModeloRam}`;
                    }

                    if (JSON.stringify(json[0].nomeModeloDisco).length > 13) {
                        maqModelDisco.innerHTML += `<marquee scrolldelay="125">${json[0].nomeModeloDisco}</marquee>`;
                    } else {
                        maqModelDisco.innerHTML += `${json[0].nomeModeloDisco}`;
                    }

                    if (JSON.stringify(json[0].escritaDisco).length > 13) {
                        maqEscritaDisco.innerHTML += `<marquee scrolldelay="125">${json[0].escritaDisco}</marquee>`;
                    } else {
                        maqEscritaDisco.innerHTML += `${json[0].escritaDisco}`;
                    }

                    if (JSON.stringify(json[0].ipv4).length > 13) {
                        maqIpv4.innerHTML += `<marquee scrolldelay="125">${json[0].ipv4}</marquee>`;
                    } else {
                        maqIpv4.innerHTML += `${json[0].ipv4}`;
                    }


                    ok.innerHTML = `${json[0].ok}%`;
                    aviso.innerHTML = `${json[0].aviso}%`;
                    perigo.innerHTML = `${json[0].perigo}%`;
                })
            }
        })
    }

    async function setar(data) {
        var a = document.getElementById("ativo");
        var i = document.getElementById("inativo");

        if (data == 0) {
            i.setAttribute("selected", "selected");
        } else if (data == 1) {
            a.setAttribute("selected", "selected");
        }
    }

    function createMaquina() {
        var idEmpresa = sessionStorage.getItem("ID_USUARIO");

        fetch(`/maquina/listar/${idEmpresa}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.status == 200) {
                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    var idLog;
                    qtdMaquina = json.length;

                    verifyQtd();

                    for (let index = 0; index < json.length; index++) {
                        containerMaquina.innerHTML += `
                        <div ondrag="dragg(${json[index].idMaquina})" class="box_maquina" id="box${index}" onclick="abrirMaquina(${json[index].idMaquina})">
                            <div class="box_nome_maquina_status">
                               <h3>${json[index].hostnameMaquina}</h3>
                            </div>
                            <div id="ram${index}" class="box_dado">                          
                            </div>
                            <div id="disco${index}" class="box_dado">
                            </div>
                            <div id="cpu${index}" class="box_dado">
                            </div>
                        </div>`;

                        var maquina = document.getElementById(`box${index}`);
                        maquina.ondrag();

                        idMaq = json[index].idMaquina;

                        var usoRam;
                        var usoDisco;
                        var usoCpu;

                        fetch(`/log/listar/${idMaq}`, {
                            method: "GET",
                            headers: {
                                "Content-Type": "application/json"
                            }
                        }).then(function (resposta) {

                            console.log("resposta: ", resposta);

                            var idRam = document.getElementById(`ram${index}`);
                            var idDisco = document.getElementById(`disco${index}`);
                            var idCpu = document.getElementById(`cpu${index}`);

                            if (resposta.status == 200) {
                                resposta.json().then(json => {
                                    console.log(json);

                                    usoRam = json[0].usoRam;
                                    usoDisco = json[0].usoDisco;
                                    usoCpu = json[0].usoCpu;

                                    idRam.innerHTML += `<span>RAM:  ${json[0].usoRam} Gb</span>`
                                    idDisco.innerHTML += `<span>Disco:  ${json[0].usoDisco} Gb</span>`
                                    idCpu.innerHTML += `<span>CPU:  ${json[0].usoCpu} %</span>`
                                })
                            }
                        })

                        fetch(`/maquina/listarPorId/${idMaq}`, {
                            method: "GET",
                            headers: {
                                "Content-Type": "application/json"
                            }
                        }).then(function (resposta) {

                            console.log("resposta: ", resposta);

                            if (resposta.status == 200) {
                                resposta.json().then(json => {
                                    console.log(json);

                                    var box = document.getElementById(`box${index}`);

                                    var limiteOk = json[0].ok;
                                    var limiteAviso = json[0].aviso;
                                    var limitePerigo = json[0].perigo;

                                    var percentDesempenhoRam = (usoRam / json[0].capacidadeTotalRam);
                                    // alert(percentDesempenhoRam);

                                    var percentDesempenhoDisco = (usoDisco / json[0].capacidadeTotalDisco);
                                    // alert(percentDesempenhoDisco);

                                    var percentDesempenhoCpu = (usoCpu / json[0].clockCpu);
                                    // alert(percentDesempenhoCpu);

                                    var percentDesempenhoMaquina = (percentDesempenhoRam + percentDesempenhoDisco + percentDesempenhoCpu) / 3;

                                    // alert((percentDesempenhoMaquina * 100).toFixed(2))

                                    if (limiteOk > limitePerigo) {
                                        if (percentDesempenhoMaquina >= limiteOk) {
                                            box.classList.toggle("box_dado_green");
                                        } else if (percentDesempenhoMaquina >= limiteAviso || (percentDesempenhoMaquina > limiteAviso && percentDesempenhoMaquina < limitePerigo)) {
                                            box.classList.toggle("box_dado_yellow");
                                        } else {
                                            box.classList.toggle("box_dado_red");
                                        }
                                    } else {
                                        if (percentDesempenhoMaquina <= limiteOk) {
                                            box.classList.toggle("box_dado_green");
                                        } else if (percentDesempenhoMaquina <= limiteAviso || (percentDesempenhoMaquina > limiteAviso && percentDesempenhoMaquina < limitePerigo)) {
                                            box.classList.toggle("box_dado_yellow");
                                        } else {
                                            box.classList.toggle("box_dado_red");
                                        }
                                    }
                                })
                            }
                        })
                    }

                })
            } else if (resposta.status == 204) {
                qtdMaquina = 0;

                verifyQtd();
            } else {
                throw ("Houve um erro ao tentar realizar a listagem das máquinas!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }

    async function dragg(id) {
        $(function () {
            var $maquinaBox = $("#maquinas_box"),
                $remove = $("#box_tool_remove"),
                $edit = $("#box_tool_edit");

            $(".box_maquina", $maquinaBox).draggable({
                revert: "invalid",
                containment: "document",
                helper: "clone",
                start: function (event, ui) {
                    $(this).addClass("helperMaquina");
                    $remove.addClass("dropRemove");
                    $edit.addClass("dropEdit");
                },
                stop: function (event, ui) {
                    $(this).removeClass("helperMaquina");
                    $remove.removeClass("dropRemove");
                    $edit.removeClass("dropEdit");
                },
                cursor: "move",
            });

            $remove.droppable({
                accept: ".box_maquina",
                drop: function (event, ui) {

                    Swal.fire({
                        title: 'Aviso',
                        text: 'Você deseja excluir essa máquina?',
                        icon: 'warning',
                        confirmButtonText: 'Confirmar',
                        showCancelButton: true,
                        cancelButtonText: 'Cancelar'
                    }).then((result) => {
                        if (result.isConfirmed) {

                            fetch(`/maquina/deletar/${id}`, {
                                method: "PATCH",
                                headers: {
                                    "Content-Type": "application/json"
                                }
                            }).then(function (resposta) {

                                console.log("resposta: ", resposta);

                                if (resposta.status === 204) {
                                    $(ui.helper).remove();
                                    $(ui.draggable).remove();
                                    qtdMaquina--;
                                    verifyQtd();

                                    Swal.fire(
                                        'Sucesso!',
                                        'A máquina foi deletada.',
                                        'success'
                                    )
                                }
                                location.reload();
                            })
                        }
                    })
                }
            });

            $edit.droppable({
                accept: ".box_maquina",
                classes: {
                    "ui-droppable-active": "ui-state-highlight"
                },
                drop: async function (event, ui) {

                    fetch(`/maquina/listarPorId/${id}`, {
                        method: "GET",
                        headers: {
                            "Content-Type": "application/json"
                        }
                    }).then(async function (resposta) {

                        console.log("resposta: ", resposta);

                        var modeloDiscoVar;
                        var armazenamentoVar;
                        var modeloRamVar;
                        var ramVar;
                        var modeloCpuVar;
                        var leituraDicoVar;
                        var escritaDiscoVar;
                        var nomeHostVar;
                        var clockCpuVar;
                        var statusVar;

                        if (resposta.ok) {
                            resposta.json().then(async json => {
                                console.log(json);
                                console.log(JSON.stringify(json));

                                const { value: formValues } = await Swal.fire({
                                    customClass: {
                                        confirmButton: 'btn_maquina',
                                    },
                                    buttonsStyling: false,
                                    title: 'Edição de máquina',
                                    width: 1010,
                                    confirmButtonText: 'Editar',
                                    html:
                                        '<div class="all_edit">' +
                                        '<div class="box_edit_modal">' +
                                        `<input id="swal-input1" placeholder="Modelo disco: ${json[0].nomeModeloDisco}" class="box_dado_maquina" required><br>` +
                                        `<input id="swal-input2" placeholder="Armazenamento Gb: ${json[0].capacidadeTotalDisco}" class="box_dado_maquina" required><br>` +
                                        `<input id="swal-input3" placeholder="Modelo RAM: ${json[0].nomeModeloRam}" class="box_dado_maquina" required><br>` +
                                        `<input id="swal-input4" placeholder="RAM Gb: ${json[0].capacidadeTotalRam}" class="box_dado_maquina" required><br>` +
                                        `<input id="swal-input5" placeholder="Modelo cpu: ${json[0].nomeModeloCpu}" class="box_dado_maquina" required><br>` +
                                        '</div>' +
                                        '<div class="box_edit_modal">' +
                                        `<input id="swal-input6" placeholder="Leitura disco: ${json[0].leituraDisco}" class="box_dado_maquina" required><br>` +
                                        `<input id="swal-input7" placeholder="Escrita disco: ${json[0].escritaDisco}" class="box_dado_maquina" required><br>` +
                                        `<input id="swal-input8" placeholder="Nome host: ${json[0].hostnameMaquina}" class="box_dado_maquina" required><br>` +
                                        `<input id="swal-input9" placeholder="Clock cpu: ${json[0].clockCpu}" class="box_dado_maquina" required><br>` +
                                        `<select id="swal-input10" class="box_dado_maquina input_complement"> 
                                        <option id="ativo" value="true">Ativo</option> 
                                        <option id="inativo" value="false">Inativo</option> 
                                        </select>
                                        <div class="box_data_statusMaquina">
                                        ${setTimeout(() => {
                                            setar(json[0].statusMaquina.data);
                                        }, "100")
                                        }
                                        </div>` +
                                        '</div>' +
                                        '</div>',
                                    focusConfirm: false,
                                    preConfirm: () => {

                                        if (document.getElementById("swal-input1").value == '') {
                                            modeloDiscoVar = json[0].nomeModeloDisco;
                                        } else {
                                            modeloDiscoVar = document.getElementById("swal-input1").value;
                                        }

                                        if (document.getElementById("swal-input2").value == '') {
                                            armazenamentoVar = json[0].capacidadeTotalDisco;
                                        } else {
                                            armazenamentoVar = document.getElementById("swal-input2").value;
                                        }

                                        if (document.getElementById("swal-input3").value == '') {
                                            modeloRamVar = json[0].nomeModeloRam;
                                        } else {
                                            modeloRamVar = document.getElementById("swal-input3").value;
                                        }

                                        if (document.getElementById("swal-input4").value == '') {
                                            ramVar = json[0].capacidadeTotalRam;
                                        } else {
                                            ramVar = document.getElementById("swal-input4").value;
                                        }

                                        if (document.getElementById("swal-input5").value == '') {
                                            modeloCpuVar = json[0].nomeModeloCpu;
                                        } else {
                                            modeloCpuVar = document.getElementById("swal-input5").value;
                                        }

                                        if (document.getElementById("swal-input6").value == '') {
                                            leituraDicoVar = json[0].leituraDisco;
                                        } else {
                                            leituraDicoVar = document.getElementById("swal-input6").value;
                                        }

                                        if (document.getElementById("swal-input7").value == '') {
                                            escritaDiscoVar = json[0].escritaDisco;
                                        } else {
                                            escritaDiscoVar = document.getElementById("swal-input7").value;
                                        }

                                        if (document.getElementById("swal-input8").value == '') {
                                            nomeHostVar = json[0].hostnameMaquina;
                                        } else {
                                            nomeHostVar = document.getElementById("swal-input8").value;
                                        }

                                        if (document.getElementById("swal-input9").value == '') {
                                            clockCpuVar = json[0].clockCpu;
                                        } else {
                                            clockCpuVar = document.getElementById("swal-input9").value;
                                        }

                                        if (document.getElementById("swal-input10").value == '') {
                                            statusVar = json[0].statusMaquina.data;
                                        } else {
                                            statusVar = document.getElementById("swal-input10").value;
                                        }

                                        return [
                                            modeloDiscoVar,
                                            armazenamentoVar,
                                            modeloRamVar,
                                            ramVar,
                                            modeloCpuVar,
                                            leituraDicoVar,
                                            escritaDiscoVar,
                                            nomeHostVar,
                                            clockCpuVar,
                                            statusVar
                                        ]
                                    }
                                })

                                fetch(`/maquina/editar/${id}`, {
                                    method: "PATCH",
                                    headers: {
                                        "Content-Type": "application/json"
                                    },
                                    body: JSON.stringify({
                                        modeloDiscoServer: modeloDiscoVar,
                                        armazenamentoServer: armazenamentoVar,
                                        modeloRamServer: modeloRamVar,
                                        ramServer: ramVar,
                                        modeloCpuServer: modeloCpuVar,
                                        leituraDiscoServer: leituraDicoVar,
                                        escritaDiscoServer: escritaDiscoVar,
                                        nomeHostServer: nomeHostVar,
                                        clockCpuServer: clockCpuVar,
                                        statusServer: statusVar,
                                    }),
                                })

                                if (formValues) {
                                    location.reload();
                                }
                            })
                        }
                    })
                }
            })
        })

        return id;
    }

    const ctx = document.getElementById('myChart');
    const ctx2 = document.getElementById('myChart2');
    const ctx3 = document.getElementById('myChart3');

    function abrirGrafico(numGraph) {

        var idEmpresa = sessionStorage.getItem("ID_USUARIO");

        fetch(`/limites/listarGrafico/${idEmpresa}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {
            if (resposta.ok) {
                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                    Swal.fire({
                        customClass: {
                            confirmButton: 'btn_grafico',
                        },
                        // buttonsStyling: false,
                        title: 'Métrica',
                        text: 'Conteúdo',
                        confirmButtonText: 'Atualizar',
                        showCancelButton: true,
                        cancelButtonText: 'Cancelar',
                        html:
                            '<div class="all_edit_grafico">' +
                            '<div class="box_edit_modal_grafico">' +
                            `<input id="ok" placeholder="Ok: ${json[numGraph].ok}%" class="box_dado_maquina" required><br>` +
                            `<input id="aviso" placeholder="Aviso: ${json[numGraph].aviso}%" class="box_dado_maquina" required><br>` +
                            `<input id="perigo" placeholder="Perigo: ${json[numGraph].perigo}%" class="box_dado_maquina" required><br>` +
                            '</div>' +
                            '</div>',
                    }).then((result) => {
                        if (result.isConfirmed) {

                            var okVar;
                            var avisoVar;
                            var perigoVar;

                            if (document.getElementById("ok").value == '') {
                                okVar = json[numGraph].ok
                            } else {
                                okVar = document.getElementById("ok").value;
                            }

                            if (document.getElementById("aviso").value == '') {
                                avisoVar = json[numGraph].aviso
                            } else {
                                avisoVar = document.getElementById("aviso").value;
                            }

                            if (document.getElementById("perigo").value == '') {
                                perigoVar = json[numGraph].perigo
                            } else {
                                perigoVar = document.getElementById("perigo").value;
                            }

                            fetch(`/limites/atualizarGrafico`, {
                                method: "PUT",
                                headers: {
                                    "Content-Type": "application/json"
                                },
                                body: JSON.stringify({
                                    okServer: okVar,
                                    avisoServer: avisoVar,
                                    perigoServer: perigoVar,
                                    idLimitesServer: json[numGraph].idLimites
                                }),
                            }).then(async function (resposta) {

                                Swal.fire(
                                    'Sucesso!',
                                    'A métrica foi atualizada.',
                                    'success'
                                )
                                setTimeout(() => {
                                    location.reload();
                                }, 1000);

                            })

                        }
                    })
                })
            }
        })
    }

    var percentFinal1;
    var percentFinal2;
    var percentFinal3;

    var statusGrafico1;
    var statusGrafico2;
    var statusGrafico3;

    var boxAlert1 = document.getElementById("box_alert_grafico1");
    var boxAlert2 = document.getElementById("box_alert_grafico2");
    var boxAlert3 = document.getElementById("box_alert_grafico3");

    var created = false;
    var level;

    var minutos = [];
    var recebidos = [];
    var enviados = [];
    var somaRecebidos = 0;
    var somaEnviados = 0;
    var graph = true;

    var minutosFinal = [];
    var dataFinal = [];
    var dataFinalEnviado = [];
    var idEmpresa = sessionStorage.getItem("ID_USUARIO");
    var qtdBytes = 0;

    function verifyStatus() {

        // setInterval(() => {
        fetch(`/dashboard/listarBytesHorario/${idEmpresa}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                resposta.json().then(json => {
                    qtdBytes = json.length;

                    for (let index = 0; index < json.length; index++) {
                        minutos.push(json[index].intervaloMinuto);
                        recebidos.push(json[index].totalBytesRecebidos);
                        enviados.push(json[index].totalBytesEnviados);
                        somaRecebidos += Number(json[index].totalBytesRecebidos);
                        somaEnviados += Number(json[index].totalBytesEnviados);
                    }

                    moment.locale('pt-br');
                    for (let index = json.length; index >= 0; index--) {
                        const dta = moment(minutos[index - 1]).format('HH:mm');
                        minutosFinal.push(dta);
                    }

                    for (let index = json.length; index >= 0; index--) {
                        dataFinal.push(recebidos[index - 1]);
                    }

                    for (let index = json.length; index >= 0; index--) {
                        dataFinalEnviado.push(enviados[index - 1]);
                    }

                    percentFinal1 = Math.round((((somaEnviados + somaRecebidos) / 2) / (json.length * 1000)) * 100);
                    statusGrafico1 = percentFinal1;

                    var perigo1 = valuePerigo1;
                    var aviso1 = valueAviso1;
                    var ok1 = valueOk1;

                    if (ok1 > perigo1) {
                        if (statusGrafico1 >= ok1) {
                            box_alert_grafico1.innerHTML = `<span id="valuePercent1">${statusGrafico1}%</span> <img src='./assets/imgs/correto.png'>`;
                        } else if (statusGrafico1 >= aviso1 || (statusGrafico1 > aviso1 && statusGrafico1 < perigo1)) {
                            box_alert_grafico1.innerHTML = `<span id="valuePercent1">${statusGrafico1}%</span> <img src='./assets/imgs/aviso.png'>`;
                        } else {
                            box_alert_grafico1.innerHTML = `<span id="valuePercent1">${statusGrafico1}%</span> <img src='./assets/imgs/perigo.png'>`;
                        }
                    } else {
                        if (statusGrafico1 <= ok1) {
                            box_alert_grafico1.innerHTML = `<span id="valuePercent1">${statusGrafico1}%</span> <img src='./assets/imgs/correto.png'>`;
                        } else if (statusGrafico1 <= aviso1 || (statusGrafico1 > aviso1 && statusGrafico1 < perigo1)) {
                            box_alert_grafico1.innerHTML = `<span id="valuePercent1">${statusGrafico1}%</span> <img src='./assets/imgs/aviso.png'>`;
                        } else {
                            box_alert_grafico1.innerHTML = `<span id="valuePercent1">${statusGrafico1}%</span> <img src='./assets/imgs/perigo.png'>`;
                        }
                    }

                    if (ok1 > perigo1) {
                        if (statusGrafico1 >= ok1) {
                            boxAlert1.classList.toggle("alertOk");
                        } else if (statusGrafico1 >= aviso1 || (statusGrafico1 < aviso1 && statusGrafico1 > perigo1)) {
                            boxAlert1.classList.toggle("alertAviso");
                        } else {
                            boxAlert1.classList.toggle("alertPerigo");
                        }
                    } else {
                        if (statusGrafico1 <= ok1) {
                            boxAlert1.classList.toggle("alertOk");
                        } else if (statusGrafico1 <= aviso1 || (statusGrafico1 > aviso1 && statusGrafico1 < perigo1)) {
                            boxAlert1.classList.toggle("alertAviso");
                        } else {
                            boxAlert1.classList.toggle("alertPerigo");
                        }
                    }
                    var graph1 = document.getElementById("valuePercent1");
                    graph1.innerHTML = `${percentFinal1}%`;
                })
            }
        })
        // }, 10000);

        fetch(`/dashboard/listarStatusMaquina/${idEmpresa}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    var qtdStatus = json[0][0].QTD;

                    var percentAtivo = json[0][0].ATIVO / qtdStatus;

                    percentFinal2 = Math.round(percentAtivo * 100);
                    statusGrafico2 = percentFinal2;

                    var perigo2 = valuePerigo2;
                    var aviso2 = valueAviso2;
                    var ok2 = valueOk2;

                    if (ok2 > perigo2) {
                        if (statusGrafico2 >= ok2) {
                            box_alert_grafico2.innerHTML += `<span id="valuePercent2">${statusGrafico2}%</span> <img id="statusGraph" src='./assets/imgs/correto.png'>`;
                        } else if (statusGrafico2 >= aviso2 || (statusGrafico2 < aviso2 && statusGrafico2 > perigo2)) {
                            box_alert_grafico2.innerHTML += `<span id="valuePercent2">${statusGrafico2}%</span> <img id="statusGraph" src='./assets/imgs/aviso.png'>`;
                        } else {
                            box_alert_grafico2.innerHTML += `<span id="valuePercent2">${statusGrafico2}%</span> <img id="statusGraph" src='./assets/imgs/perigo.png'>`;
                        }
                    } else {
                        if (statusGrafico2 <= ok2) {
                            box_alert_grafico2.innerHTML += `<span id="valuePercent2">${statusGrafico2}%</span> <img id="statusGraph" src='./assets/imgs/correto.png'>`;
                        } else if (statusGrafico2 <= aviso2 || (statusGrafico2 > aviso2 && statusGrafico2 < perigo2)) {
                            box_alert_grafico2.innerHTML += `<span id="valuePercent2">${statusGrafico2}%</span> <img id="statusGraph" src='./assets/imgs/aviso.png'>`;
                        } else {
                            box_alert_grafico2.innerHTML += `<span id="valuePercent2">${statusGrafico2}%</span> <img id="statusGraph" src='./assets/imgs/perigo.png'>`;
                        }
                    }

                    if (ok2 > perigo2) {
                        if (statusGrafico2 >= ok2) {
                            boxAlert2.classList.toggle("alertOk");
                        } else if (statusGrafico2 >= aviso2 || (statusGrafico2 < aviso2 && statusGrafico2 > perigo2)) {
                            boxAlert2.classList.toggle("alertAviso");
                        } else {
                            boxAlert2.classList.toggle("alertPerigo");
                        }
                    } else {
                        if (statusGrafico2 <= ok2) {
                            boxAlert2.classList.toggle("alertOk");
                        } else if (statusGrafico2 <= aviso2 || (statusGrafico2 > aviso2 && statusGrafico2 < perigo2)) {
                            boxAlert2.classList.toggle("alertAviso");
                        } else {
                            boxAlert2.classList.toggle("alertPerigo");
                        }
                    }

                    if (qtdStatus == 0) {
                        var status = document.getElementById("statusGraph");
                        status.classList.toggle("imgStatus");
                        boxAlert2.classList.toggle("emptyPercent")
                    }

                    var graph2 = document.getElementById("valuePercent2");
                    graph2.innerHTML = `${qtdStatus != 0 ? percentFinal2 : 0}%`;

                    new Chart(ctx2, {
                        type: 'pie',
                        data: {
                            labels: ['Ativo', 'Inativo'],
                            datasets: [{
                                label: 'Quantidade de computadores',
                                data: [json[0][0].ATIVO, json[0][0].INATIVO],
                                borderWidth: 1
                            }]
                        },
                    });
                })
            }
        })

        setTimeout(() => {
            percentFinal3 = Math.round(0.5 * 100);
            statusGrafico3 = percentFinal3;
            var perigo3 = valuePerigo3;
            var aviso3 = valueAviso3;
            var ok3 = valueOk3;

            if (ok3 > perigo3) {
                if (statusGrafico3 >= ok3) {
                    box_alert_grafico3.innerHTML += `<span id="valuePercent3">${statusGrafico3}%</span> <img src='./assets/imgs/correto.png'>`;
                } else if (statusGrafico3 >= aviso3 || (statusGrafico3 > aviso3 && statusGrafico3 < perigo3)) {
                    box_alert_grafico3.innerHTML += `<span id="valuePercent3">${statusGrafico3}%</span> <img src='./assets/imgs/aviso.png'>`;
                } else {
                    box_alert_grafico3.innerHTML += `<span id="valuePercent3">${statusGrafico3}%</span> <img src='./assets/imgs/perigo.png'>`;
                }
            } else {
                if (statusGrafico3 <= ok3) {
                    box_alert_grafico3.innerHTML += `<span id="valuePercent3">${statusGrafico3}%</span> <img src='./assets/imgs/correto.png'>`;
                } else if (statusGrafico3 <= aviso3 || (statusGrafico3 > aviso3 && statusGrafico3 < perigo3)) {
                    box_alert_grafico3.innerHTML += `<span id="valuePercent3">${statusGrafico3}%</span> <img src='./assets/imgs/aviso.png'>`;
                } else {
                    box_alert_grafico3.innerHTML += `<span id="valuePercent3">${statusGrafico3}%</span> <img src='./assets/imgs/perigo.png'>`;
                }
            }

            if (ok3 > perigo3) {
                if (statusGrafico3 >= ok3) {
                    boxAlert3.classList.toggle("alertOk");
                } else if (statusGrafico3 >= aviso3 || (statusGrafico3 < aviso3 && statusGrafico3 > perigo3)) {
                    boxAlert3.classList.toggle("alertAviso");
                } else {
                    boxAlert3.classList.toggle("alertPerigo");
                }
            } else {
                if (statusGrafico3 <= ok3) {
                    boxAlert3.classList.toggle("alertOk");
                } else if (statusGrafico3 <= aviso3 || (statusGrafico3 > aviso3 && statusGrafico3 < perigo3)) {
                    boxAlert3.classList.toggle("alertAviso");
                } else {
                    boxAlert3.classList.toggle("alertPerigo");
                }
            }

            var graph3 = document.getElementById("valuePercent3");

            graph3.innerHTML = `${percentFinal3}%`;

            new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'],
                    datasets: [{
                        label: 'Uso dos computadores',
                        data: [12, 19, 3, 5, 2, 3],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }, 100);
    }

    verifyStatus();

    // level = new Chart(ctx, {
    //     type: 'line',
    //     data: {
    //         labels: minutosFinal,
    //         datasets: [{
    //             label: 'Enviados',
    //             backgroundColor: '#FF6961',
    //             borderColor: '#FF6961',
    //             data: dataFinalEnviado,
    //         },
    //         {
    //             label: 'Recebidos',
    //             backgroundColor: '#4169E1',
    //             borderColor: '#4169E1',
    //             data: dataFinal,
    //         }]
    //     },
    //     options: {
    //         scales: {
    //             y: {
    //                 beginAtZero: true
    //             }
    //         }
    //     }
    // });

    setTimeout(() => {
        let labels = [];
        let dados = {
            labels: labels,
            datasets: [
                {
                    label: 'Bytes Recebidos',
                    data: [],
                    fill: false,
                    borderColor: "#b91d47",
                    backgroundColor: "#b91d47",
                    tension: 0.1
                },
                {
                    label: 'Bytes Enviados',
                    data: [],
                    fill: false,
                    borderColor: "#00aba9",
                    backgroundColor: "#00aba9",
                    tension: 0.1
                }
            ]
        };

        console.log('----------------------------------------------');
        console.log('Estes dados foram recebidos pela função "obterDados" e passados para "desenharGrafico":');

        function atualizarGrafico() {
            for (let i = 0; i < qtdBytes; i++) {
                dados.labels.push(minutosFinal[i]);
                dados.datasets[0].data.push(dataFinalEnviado[i]);
                dados.datasets[1].data.push(dataFinal[i]);
            }

            console.log('----------------------------------------------');
            console.log('O gráfico será plotado com os respectivos valores:');
            console.log('Labels:');
            console.log(labels);
            console.log('Dados Recebidos:');
            console.log(dados.datasets[0].data);
            console.log('Dados Enviados:');
            console.log(dados.datasets[1].data);
            console.log('----------------------------------------------');

            const config = {
                type: 'line',
                data: dados
            };

            let bytes = new Chart(
                ctx,
                config
            );

            // setInterval(() => {
            obterNovosDados().then(novosDados => {
                dados.labels = [];
                dados.datasets[0].data = [];
                dados.datasets[1].data = [];

                for (let i = 0; i < qtdBytes; i++) {
                    dados.labels.push(novosDados.minutosFinal[i]);
                    dados.datasets[0].data.push(novosDados.dataFinal[i]);
                    dados.datasets[1].data.push(novosDados.dataFinalEnviado[i]);
                }

                bytes.update();
            }).catch(error => {
                console.log('Erro ao obter novos dados:', error);
            });
            // }, 1000);
        }

        function obterNovosDados() {
            return new Promise((resolve, reject) => {
                // Fazer a requisição AJAX para obter os novos dados
                // Substitua o trecho abaixo pelo seu código de requisição

                fetch(`/dashboard/listarBytesHorario/${idEmpresa}`, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json"
                    }
                }).then(function (resposta) {
                    if (resposta.ok) {
                        resposta.json().then(json => {
                            let minutosFinal = [];
                            let dataFinal = [];
                            let dataFinalEnviado = [];

                            for (let index = json.length; index > 0; index--) {
                                minutosFinal.push(moment(json[index - 1].intervaloMinuto).format('HH:mm'));
                                dataFinal.push(json[index - 1].totalBytesRecebidos);
                                dataFinalEnviado.push(json[index - 1].totalBytesEnviados);
                            }

                            resolve({
                                minutosFinal: minutosFinal,
                                dataFinal: dataFinal,
                                dataFinalEnviado: dataFinalEnviado
                            });
                        });
                    } else {
                        reject(new Error('Erro na requisição'));
                    }
                }).catch(error => {
                    reject(error);
                });
            });
        }

        atualizarGrafico();
    }, 1000);
    // setTimeout(() => atualizarGrafico(idEmpresa, dados, bytes), 1000);

</script>

</html>